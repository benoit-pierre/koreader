diff --git a/lib/libzsync/zsync.c b/lib/libzsync/zsync.c
--- a/lib/libzsync/zsync.c
+++ b/lib/libzsync/zsync.c
@@ -739,7 +739,7 @@ static int zsync_recompress(struct zsync_state *zs) {
                 rc = -1;
             }
         }
-        if (fclose(g) != 0) {
+        if (pclose(g) != 0) {
             perror("close");
             rc = -1;
         }
